<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>U-Boot Boot Flow - Under the hood</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="BabuSubashChandar C"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="boot-flow.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress" data-transition-duration="1500"><div class="step step-level-1" step="0" data-scale="20" id="title" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-x="0" data-y="0" data-z="0"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"><h1 id="u-boot-boot-flow-under-the-hood"><strong>U-Boot Boot Flow</strong> - Under the hood</h1><p>BabuSubashChandar C</p><p><a href="mailto:babusubashchandar@zilogic.com">babusubashchandar@zilogic.com</a></p></div><div class="step step-level-1" step="1" data-scale="1" data-x="4000" data-y="1800" id="boot-flow" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="typical-boot-flow">Typical Boot flow</h1><img src="typical-boot-flow.png"></img></div><div class="step step-level-1" step="2" data-x="5200" id="boot-methods" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-y="3600" data-z="0"><h1 id="boot-methods">Boot Methods</h1><ul><li>Bootloader from various locations (flash devices, sdcard, etc.)</li><li>Kernel from various locations (flash, network, sdcard, usb, etc.)</li><li>Filesystem from various locations (flash, network, sdcard, usb, etc.)</li></ul></div><div class="step step-level-1" step="3" data-x="6400" data-y="2400" id="parched-of-resources" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-z="0"><h1 id="parched-of-resources">Parched of Resources</h1><ul><li>Applications need memory management or Scheduling.</li><li>Kernel requires timer &amp; memory to operate.</li><li><strong>Bootloader</strong> loads Kernel with required resources.</li></ul></div><div class="step step-level-1" step="4" data-x="6400" data-y="1200" id="imnot-thirsty" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-z="0"><h1 id="i-m-not-thirsty">I'm not thirsty</h1><pre class="highlight code c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"helloworld"</span><span class="p">);</span>
<span class="p">}</span></pre><ul><li>Even a simple c program, requires a lot of setup to be done in
prior.</li><li>Setup stack &#x27BD; initialize global data &#x27BD; initialize read-only data.</li></ul></div><div class="step step-level-1" step="5" data-x="7600" data-y="1200" id="ftf" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-z="0"><h1 id="first-things-first">First Things First</h1><ul><li>On POR, processor goes to RomBoot code.</li><li>Looks for various options to get primary bootloader.</li><li>Now primary bootloader loads U-Boot.</li></ul></div><div class="step step-level-1" step="6" data-x="8800" data-y="2000" data-next-step="starthere" id="treasurehunt" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-z="0"><h1 id="treasure-hunt">Treasure Hunt</h1><img src="pirate.png"></img><p>Here, map is the <strong>Treasure</strong> mate!!</p></div><div class="step step-level-1" step="7" data-x="9800" data-y="4400" id="map" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-z="0"><img src="u-boot-background.png" width="1024" height="764"></img></div><div class="step step-level-1" step="8" data-x="9550" data-y="4640" data-scale="0.15" id="starthere" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="start">Start</h1><ul><li>Clears out icache, dcache and mmu tables if any.</li></ul><p>arch/&lt;arch&gt;/cpu/soc/start.S &#x27BD; reset.</p></div><div class="step step-level-1" step="9" data-x="9550" data-y="4440" id="runtime-setup" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="runtime-setup">Runtime setup</h1><ul><li>Setup the c runtime dependencies.</li><li>Run lowlevel_init if any.</li><li>Initialize the resources one by one.</li><li>Calls board_init_f_alloc_reserve.</li></ul><p>arch/arm/lib/crt0.S</p></div><div class="step step-level-1" step="10" data-x="9555" data-y="4180" id="common-init" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="common-initialization">Common initialization</h1><ul><li>Sets up stack.</li><li>Sets up global data.</li><li>Sets up local data.</li><li>Shows boot progress.</li></ul><p>common/init/board_init.c</p></div><div class="step step-level-1" step="11" data-x="9755" data-y="4310" id="init-seq" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="initializations-in-sequence">Initializations in Sequence</h1><ul><li>A sequence of functions will be called one by one.</li><li>Boot stage at this level will be marked.</li></ul><p>common/board_f.c</p></div><div class="step step-level-1" step="12" data-x="9915" data-y="4380" id="soc-init" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="soc-initialization">SoC initialization</h1><ul><li>Initialize hardware timer.</li><li>Initialize flash device with environment setup.</li><li>Check for integrity of environment.</li></ul><p>arch/&lt;arch&gt;/cpu/&lt;soc-family&gt;/&lt;soc&gt;.c</p></div><div class="step step-level-1" step="13" data-x="10095" data-y="4200" id="board-init" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="board-initialization">Board initialization</h1><ul><li>Common board related informations.</li><li>CPU and CPU revision information.</li><li>Information about the U-Boot itself.</li></ul><p>common/board_f.c</p><p>arch/&lt;arch&gt;/cpu/&lt;soc&gt;/cpuinfo.c</p><p>board/&lt;vendor&gt;/&lt;board&gt;/&lt;board&gt;.c</p></div><div class="step step-level-1" step="14" data-x="10295" data-y="4220" id="driver-init" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="driver-initialization">Driver initialization</h1><ul><li>Initialize serial device.</li><li>Initialize console output.</li><li>Initialize network device.</li></ul><p>drivers/&lt;device&gt;/&lt;device&gt;.c</p><p>common/console.c</p></div><div class="step step-level-1" step="15" data-x="9835" data-y="4580" id="ram-init" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="ram-initialization">RAM initialization</h1><ul><li>As per SoC memory map, DRAM will be initialized.</li><li>U-Boot stores its global and local data in DRAM.</li><li>Preserves the data store in memory from modifications.</li><li>Configures the size of each area in stack.</li><li>Displays the information about DRAM.</li></ul><p>arch/&lt;arch&gt;/cpu/&lt;soc&gt;/&lt;soc&gt;.c
common/board_f.c</p></div><div class="step step-level-1" step="16" data-x="10155" data-y="4620" id="autoboot" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="autoboot">AutoBoot</h1><ul><li>Attempts autoboot using bootcmd configured in environment.</li><li>Gets the Image to memory.</li><li>Finds the OS type.</li><li>Consolidates the environment and global data to be passed. Places
them in memory.</li><li>Boots the OS; Jumps to OS. Control is no more available in U-Boot.</li></ul><p>common/bootm.c</p></div><div class="step step-level-1" step="17" data-x="10755" data-y="4620" id="calltrace" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="detailed-calltrace">Detailed Calltrace</h1><ul><li><strong>reset</strong> - arch/arm/cpu/pxa/start.S</li><li><strong>cpu_init_crit</strong> - arch/arm/cpu/pxa/start.S</li><li><strong>board_init_f_alloc_reserve</strong> - common/init/board_init.c</li><li><strong>board_init_f_init_reserve</strong> - common/init/board_init.c</li><li><strong>show_boot_progress</strong> - common/init/board_init.c</li><li><strong>mark_bootstage</strong> - common/board_f.c</li><li><strong>initcall_run_list</strong> - lib/initcall.c</li><li><strong>timer_init</strong> - arch/arm/cpu/pxa/timer.c</li><li><strong>env_init</strong> - common/env_flash.c</li><li><strong>crc32_no_comp</strong> - lib/crc32.c</li></ul></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-x="11355" data-y="4620" data-z="0"><h1 id="detailed-calltrace-contd">Detailed Calltrace (contd.)</h1><ul><li><strong>serial_init</strong> - drivers/serial/serial.c</li><li><strong>console_init_f</strong> - common/console.c</li><li><strong>dram_init</strong> - board/gumstix/verdex/verdex.c</li><li><strong>pxa2xx_dram_init</strong> - arch/arm/cpu/pxa/pxa2xx.c</li><li><strong>setup_machine</strong> - common/board_f.c</li><li><strong>setup_dram_config</strong> - common/board_f.c</li><li><strong>dram_init_banksize</strong> - common/board_f.c</li><li><strong>show_dram_config</strong> - common/board_f.c</li><li><strong>reloc_fdt</strong> - common/board_f.c</li><li><strong>setup_reloc</strong> - common/board_f.c</li></ul></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-x="11955" data-y="4620" data-z="0"><h1 id="id1">Detailed Calltrace (contd.)</h1><ul><li><strong>load_env</strong> - common/bootm.c</li><li><strong>autoboot</strong> - common/bootm.c</li><li><strong>do_bootm</strong> - common/bootm.c</li><li><strong>do_bootm_states</strong> - common/bootm.c</li><li><strong>bootm_find_os</strong> - common/bootm.c</li><li><strong>bootm_load_os</strong> - common/bootm.c</li><li><strong>boot_relocate_fdt</strong> - common/bootm.c</li><li><strong>boot_selected_os</strong> - common/bootm.c</li></ul></div><div class="step step-level-1" step="20" data-x="12555" data-y="4720" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="questions"><strong>Questions</strong></h1></div><div class="step step-level-1" step="21" id="references" data-x="13155" data-y="4820" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-z="0"><h1 id="references">References</h1><ul><li><a href="http://www.slideshare.net/HouchengLin/uboot-startup-sequence">http://www.slideshare.net/HouchengLin/uboot-startup-sequence</a></li><li><a href="http://www.denx.de/wiki/pub/U-Boot/SummitELCE2015/U-Boot_startup_sequence.pdf">http://www.denx.de/wiki/pub/U-Boot/SummitELCE2015/U-Boot_startup_sequence.pdf</a></li><li>Reading the source is healthy - <a href="http://git.denx.de/?p=u-boot.git">http://git.denx.de/?p=u-boot.git</a></li></ul></div><div class="step step-level-1" step="22" id="followme" data-x="13755" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="0.15" data-y="4920" data-z="0"><h1 id="follow-me"><strong>Follow me</strong></h1><div class="followme">
<table border=0 align="center">
<tr><td>
<i class="fa fa-linkedin-square"></i></td><td><p>&nbsp;&nbsp;babuenir</p></td></tr>
<tr><td><i class="fa fa-twitter"></i><td><p>&nbsp;&nbsp;@babuenir</p></td></tr>
<tr><td><i class="fa fa-github"></i><td><p>&nbsp;&nbsp;babuenir</p></td></tr></table></div></div></div><div id="hovercraft-help" class="hide"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>